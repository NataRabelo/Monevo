{% extends 'base.html' %}

{% block title %}Contas & Cartões | Monevo{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/contas.css') }}">
{% endblock %}

{% block content %}
<div class="container py-5 tela-central">
  <div class="card sombra-caixa p-4">

    <!-- Abas -->
    <ul class="nav nav-tabs mb-4" id="abaCadastro" role="tablist">
      <li class="nav-item" role="presentation">
        <button class="nav-link active" id="contas-tab" data-bs-toggle="tab" data-bs-target="#contas" type="button"
          role="tab">Contas</button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="cartoes-tab" data-bs-toggle="tab" data-bs-target="#cartoes" type="button"
          role="tab">Cartões</button>
      </li>
    </ul>

    <div class="tab-content" id="conteudoAbas">

      <div class="tab-pane fade show active" id="contas" role="tabpanel" aria-labelledby="contas-tab">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h3 class="mb-0">Minhas Contas</h3>
          <button class="btn btn-dark btn-sm rounded-pill" data-bs-toggle="modal" data-bs-target="#modalConta">Nova
            Conta</button>
        </div>

        <div class="row g-3">
          {% for conta in contas %}
          <div class="col-md-6 col-lg-4">
            <div class="conta-card p-3">
              <div class="d-flex justify-content-between align-items-center mb-2">
                <h5 class="conta-nome">{{ conta.nome_conta }}</h5>
                <span class="tipo">{{ conta.tipo_conta }}</span>
              </div>

              <p class="banco">Banco: {{ conta.instituicao }}</p>
              <p class="saldo">Saldo: <strong>{{ conta.saldo_inicial | currency }}</strong></p>

              <div class="acoes d-flex gap-2 mt-3">
                <button class="btn btn-outline-secondary btn-sm" data-bs-toggle="modal"
                  data-bs-target="#modalEditarConta" data-conta-id="{{ conta.id }}" data-nome="{{ conta.nome_conta }}"
                  data-instituicao="{{ conta.instituicao }}" data-saldo="{{ conta.saldo_inicial }}"
                  data-tipo="{{ conta.tipo_conta }}">
                  Editar
                </button>

                <form method="POST" action="{{ url_for('conta.deletarConta', conta_id=conta.id) }}">
                  <button class="btn btn-outline-danger btn-sm">Excluir</button>
                </form>
              </div>
            </div>
          </div>
          {% else %}
          <p class="sem-contas">Nenhuma conta cadastrada.</p>
          {% endfor %}
        </div>

      </div>

      <!-- Aba de Cartões -->
      <div class="tab-pane fade" id="cartoes" role="tabpanel" aria-labelledby="cartoes-tab">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h3 class="mb-0">Meus Cartões</h3>
          <button class="btn btn-dark btn-sm rounded-pill" data-bs-toggle="modal" data-bs-target="#modalCartao">Novo
            Cartão</button>
        </div>
        <div class="row g-4">
        {% for cartao in cartoes %} 
          <div class="col-md-6 col-lg-4">
            <div class="cartao-card">
              <div class="cartao-header">
                <h5 class="nome-cartao">{{ cartao.nome_cartao }}</h5>
                <span class="bandeira">{{ cartao.bandeira }}</span>
              </div>

              <div class="cartao-body">
                <p class="limite">Limite: {{ cartao.limite | currency }}</p>
                <p>Fechamento: dia {{ cartao.dia_fechamento_fatura }}</p>
                <p>Vencimento: dia {{ cartao.dia_vencimento_fatura }}</p>
              </div>

              <div class="cartao-footer d-flex justify-content-end gap-2">
                <button class="btn btn-outline-secondary btn-sm" data-bs-toggle="modal"
                  data-bs-target="#modalEditarCartao" 
                  data-cartao-id="{{ cartao.id }}" 
                  data-nome="{{ cartao.nome_cartao }}"
                  data-bandeira="{{ cartao.bandeira }}" 
                  data-limite="{{ cartao.limite }}"
                  data-fechamento="{{ cartao.dia_fechamento_fatura }}"
                  data-vencimento="{{ cartao.dia_vencimento_fatura }}"
                  data-conta="{{ cartao.conta_id }}">
                  Editar
                </button>

                <form method="POST" action="{{ url_for('cartao.deletarCartao', cartao_id=cartao.id) }}">
                  <button class="btn btn-outline-danger btn-sm">Excluir</button>
                </form>
              </div>

            </div>
          </div>
        {% else %}
          <p class="sem-cartoes">Nenhum cartão cadastrado.</p>
        {% endfor %}
      </div>  <!-- encerra a row só aqui -->


    </div>
  </div>
</div>

<!-- Modal Conta -->
<div class="modal fade" id="modalConta" tabindex="-1" aria-labelledby="modalContaLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cadastrar Conta</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
      </div>
      <div class="modal-body">
        <form action="{{ url_for('conta.cadastrarConta') }}" method="POST">
          <div class="mb-3">
            <label class="form-label">Nome da Conta</label>
            <input type="text" class="form-control" id="nome_conta" name="nome_conta" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Banco</label>
            <input type="text" class="form-control" id="instituicao" name="instituicao">
          </div>
          <div class="mb-3">
            <label class="form-label">Saldo Atual</label>
            <input type="text" class="form-control currency" id="saldo_inicial" name="saldo_inicial">
          </div>
          <div class="mb-3">
            <label class="form-label">Tipo</label>
            <select class="form-select" id="tipo_conta" name="tipo_conta">
              <option value="Corrente">Corrente</option>
              <option value="Poupança">Poupança</option>
              <option value="Investimento">Investimento</option>
            </select>
          </div>
          <div class="text-end">
            <button type="submit" class="btn btn-dark">Salvar</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- Modal Cartão -->
<div class="modal fade" id="modalCartao" tabindex="-1" aria-labelledby="modalCartaoLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cadastrar Cartão</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
      </div>
      <div class="modal-body">
        <form action="{{ url_for('cartao.cadastrarCartao') }}" method="POST">
          <div class="mb-3">
            <label class="form-label">Nome do Cartão</label>
            <input type="text" class="form-control" id="nome_cartao" name="nome_cartao" required>
          </div>
          <label class="form-label">Bandeira do Cartão</label>
            <select class="form-select" id="bandeira" name="bandeira">
              <option value="" disabled selected>Selecione a bandeira</option>
              <option value="Visa">Visa</option>
              <option value="Mastercard">Mastercard</option>
              <option value="Elo">Elo</option>
              <option value="American Express">American Express</option>
              <option value="Diners Club">Diners Club</option>
              <option value="Hipercard">Hipercard</option>
            </select>
          <div class="mb-3">
            <label class="form-label">Limite</label>
            <input type="text" class="form-control currency" id="limite" name="limite">
          </div>
          <div class="mb-3 d-flex gap-3">
            <div class="flex-fill">
              <label class="form-label">Fechamento</label>
              <input type="number" class="form-control" min="1" max="31" id="dia_fechamento_fatura" name="dia_fechamento_fatura">
            </div>
            <div class="flex-fill">
              <label class="form-label">Vencimento</label>
              <input type="number" class="form-control" min="1" max="31" id="dia_vencimento_fatura" name="dia_vencimento_fatura">
            </div>
          </div>
          <div class="mb-3">
            <label class="form-label">Conta do cartão</label>
            <select class="form-select" id="conta_cartao" name="conta_cartao">
              <option value="" disabled selected>Selecione a conta</option>
              {% for conta in contas %}
              <option value="{{ conta.id }}">{{ conta.nome_conta}}</option>
              {% endfor %}
            </select>
          </div>
          <div class="text-end">
            <button type="submit" class="btn btn-dark">Salvar</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>


<!-- Modal de edicao de conta -->
<div class="modal fade" id="modalEditarConta" tabindex="-1" aria-labelledby="modalEditarContaLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Editar Conta</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
      </div>
      <div class="modal-body">
        <form id="formEditarConta" action="{{ url_for('conta.editarConta') }}" method="POST">

          <input type="hidden" id="edit-conta-id" name="conta_id">

          <div class="mb-3">
            <label class="form-label">Nome da Conta</label>
            <input type="text" class="form-control" id="edit-nome-conta" name="nome_conta" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Banco</label>
            <input type="text" class="form-control" id="edit-instituicao" name="instituicao">
          </div>
          <div class="mb-3">
            <label class="form-label">Saldo Atual</label>
            <input type="text" class="form-control currency" id="edit-saldo-inicial" name="saldo_inicial">
          </div>
          <div class="mb-3">
            <label class="form-label">Tipo</label>
            <select class="form-select" id="edit-tipo_conta" name="tipo_conta">
              <option value="Corrente">Corrente</option>
              <option value="Poupança">Poupança</option>
              <option value="Investimento">Investimento</option>
            </select>
          </div>
          <div class="text-end">
            <button type="submit" class="btn btn-dark">Salvar Alterações</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- Modal de edicao de Cartão -->
<div class="modal fade" id="modalEditarCartao" tabindex="-1" aria-labelledby="modalEditarCartaoLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Editar Cartão</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
      </div>
      <div class="modal-body">
        <form id="formEditarCartao" action="{{ url_for('cartao.editarCartao') }}" method="POST">

          <input type="hidden" id="edit-cartao-id" name="cartao_id">

          <div class="mb-3">
            <label class="form-label">Nome do Cartão</label>
            <input type="text" class="form-control" id="edit-nome-cartao" name="nome_cartao" required>
          </div>
          <label class="form-label">Bandeira do Cartão</label>
            <select class="form-select" id="edit-bandeira" name="bandeira">
              <option value="" disabled selected>Selecione a bandeira</option>
              <option value="Visa">Visa</option>
              <option value="Mastercard">Mastercard</option>
              <option value="Elo">Elo</option>
              <option value="American Express">American Express</option>
              <option value="Diners Club">Diners Club</option>
              <option value="Hipercard">Hipercard</option>
            </select>
          <div class="mb-3">
            <label class="form-label">Limite</label>
            <input type="text" class="form-control currency" id="edit-limite" name="limite">
          </div>
          <div class="mb-3 d-flex gap-3">
            <div class="flex-fill">
              <label class="form-label">Fechamento</label>
              <input type="number" class="form-control" min="1" max="31" id="edit-dia-fechamento-fatura" name="dia_fechamento_fatura">
            </div>
            <div class="flex-fill">
              <label class="form-label">Vencimento</label>
              <input type="number" class="form-control" min="1" max="31" id="edit-dia-vencimento-fatura" name="dia_vencimento_fatura">
            </div>
          </div>
          <div class="mb-3">
            <label class="form-label">Conta do cartão</label>
            <select class="form-select" id="edit-conta-cartao" name="conta_cartao">
              <option value="" disabled selected>Selecione a conta</option>
              {% for conta in contas %}
              <option value="{{ conta.id }}">{{ conta.nome_conta}}</option>
              {% endfor %}
            </select>
          </div>
          <div class="text-end">
            <button type="submit" class="btn btn-dark">Salvar Alterações</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="{{ url_for('static', filename='js/Conta.js') }}"></script>
{% endblock %}