{% extends 'base.html' %}

{% block title %}Contas & Cartões | Monevo{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/contas.css') }}">
{% endblock %}

{% block content %}
<div class="container py-5 tela-central">
  <div class="card sombra-caixa p-4">

    <!-- Abas -->
    <ul class="nav nav-tabs mb-4" id="abaCadastro" role="tablist">
      <li class="nav-item" role="presentation">
        <button class="nav-link active" id="contas-tab" data-bs-toggle="tab" data-bs-target="#contas" type="button"
          role="tab">Contas</button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="cartoes-tab" data-bs-toggle="tab" data-bs-target="#cartoes" type="button"
          role="tab">Cartões</button>
      </li>
    </ul>

    <div class="tab-content" id="conteudoAbas">

      <div class="tab-pane fade show active" id="contas" role="tabpanel" aria-labelledby="contas-tab">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h3 class="mb-0">Minhas Contas</h3>
          <button class="btn btn-dark btn-sm rounded-pill" data-bs-toggle="modal" data-bs-target="#modalConta">Nova
            Conta</button>
        </div>

        <div class="row g-3">
          {% for conta in contas %}
          <div class="col-md-6 col-lg-4">
            <div class="conta-card p-3">
              <div class="d-flex justify-content-between align-items-center mb-2">
                <h5 class="conta-nome">{{ conta.nome_conta }}</h5>
                <span class="tipo">{{ conta.tipo_conta }}</span>
              </div>

              <p class="banco">Banco: {{ conta.instituicao }}</p>
              <p class="saldo">Saldo: <strong>R$ {{ conta.saldo_inicial }}</strong></p>

              <div class="acoes d-flex gap-2 mt-3">
                <button class="btn btn-outline-secondary btn-sm" data-bs-toggle="modal"
                  data-bs-target="#modalEditarConta" data-conta-id="{{ conta.id }}" data-nome="{{ conta.nome_conta }}"
                  data-instituicao="{{ conta.instituicao }}" data-saldo="{{ conta.saldo_inicial }}"
                  data-tipo="{{ conta.tipo_conta }}">
                  Editar
                </button>

                <form method="POST" action="{{ url_for('conta.deletarConta', conta_id=conta.id) }}">
                  <button class="btn btn-outline-danger btn-sm">Excluir</button>
                </form>
              </div>
            </div>
          </div>
          {% else %}
          <p class="text-muted">Nenhuma conta cadastrada.</p>
          {% endfor %}
        </div>

      </div>

      <!-- Aba de Cartões -->
      <div class="tab-pane fade" id="cartoes" role="tabpanel" aria-labelledby="cartoes-tab">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h3 class="mb-0">Meus Cartões</h3>
          <button class="btn btn-dark btn-sm rounded-pill" data-bs-toggle="modal" data-bs-target="#modalCartao">Novo
            Cartão</button>
        </div>

        <div class="row g-4">
          <!-- Card de Cartão -->
          {% for cartao in cartoes %}
          <div class="col-md-6 col-lg-4">
            <div class="cartao-card">
              <div class="cartao-header">
                <span class="nome-cartao">{{ cartao.nome_cartao }}</span>
                <span class="bandeira">{{ cartao.bandeira }}</span>
              </div>
              <div class="cartao-body">
                <p class="limite">Limite: {{ cartao.limite }}</p>
                <p>Fechamento: dia {{ cartao.dia_fechamento_fatura }}</p>
                <p>Vencimento: dia {{ cartao.dia_vencimento_fatura }}</p>
              </div>
              <div class="cartao-footer d-flex justify-content-end gap-2">
                <button class="btn btn-outline-secondary btn-sm">Editar</button>
                <button class="btn btn-outline-danger btn-sm">Excluir</button>
              </div>
            </div>
          </div>
        </div>
        {% else %}
        <p class="text-muted">Nenhum cartão cadastrado.</p>
        {% endfor %}
      </div>

    </div>
  </div>
</div>

<!-- Modal Conta -->
<div class="modal fade" id="modalConta" tabindex="-1" aria-labelledby="modalContaLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cadastrar Conta</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
      </div>
      <div class="modal-body">
        <form action="{{ url_for('conta.cadastrarConta') }}" method="POST">
          <div class="mb-3">
            <label class="form-label">Nome da Conta</label>
            <input type="text" class="form-control" id="nome-conta" name="nome-conta" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Banco</label>
            <input type="text" class="form-control" id="instituicao" name="instituicao">
          </div>
          <div class="mb-3">
            <label class="form-label">Saldo Inicial</label>
            <input type="number" step="0.01" class="form-control" id="saldo-inicial" name="saldo-inicial">
          </div>
          <div class="mb-3">
            <label class="form-label">Tipo</label>
            <select class="form-select" id="tipo-conta" name="tipo-conta">
              <option value="Corrente">Corrente</option>
              <option value="Poupança">Poupança</option>
              <option value="Investimento">Investimento</option>
            </select>
          </div>
          <div class="text-end">
            <button type="submit" class="btn btn-dark">Salvar</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- Modal Cartão -->
<div class="modal fade" id="modalCartao" tabindex="-1" aria-labelledby="modalCartaoLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cadastrar Cartão</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
      </div>
      <div class="modal-body">
        <form action="{{ url_for('cartao.cadastrarCartao') }}" method="POST">
          <div class="mb-3">
            <label class="form-label">Nome do Cartão</label>
            <input type="text" class="form-control" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Bandeira</label>
            <input type="text" class="form-control">
          </div>
          <div class="mb-3">
            <label class="form-label">Limite</label>
            <input type="number" step="0.01" class="form-control">
          </div>
          <div class="mb-3 d-flex gap-3">
            <div class="flex-fill">
              <label class="form-label">Fechamento</label>
              <input type="number" class="form-control" min="1" max="31">
            </div>
            <div class="flex-fill">
              <label class="form-label">Vencimento</label>
              <input type="number" class="form-control" min="1" max="31">
            </div>
          </div>
          <div class="text-end">
            <button type="submit" class="btn btn-dark">Salvar</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>


<!-- Modal de edicao de conta -->
<div class="modal fade" id="modalEditarConta" tabindex="-1" aria-labelledby="modalEditarContaLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Editar Conta</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
      </div>
      <div class="modal-body">
        <form id="formEditarConta" action="{{ url_for('conta.editarConta') }}" method="POST">

          <input type="hidden" id="edit-conta-id" name="conta_id">

          <div class="mb-3">
            <label class="form-label">Nome da Conta</label>
            <input type="text" class="form-control" id="edit-nome-conta" name="nome-conta" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Banco</label>
            <input type="text" class="form-control" id="edit-instituicao" name="instituicao">
          </div>
          <div class="mb-3">
            <label class="form-label">Saldo Atual</label>
            <input type="number" step="0.01" class="form-control" id="edit-saldo-atual" name="saldo-atual">
          </div>
          <div class="mb-3">
            <label class="form-label">Tipo</label>
            <select class="form-select" id="edit-tipo-conta" name="tipo-conta">
              <option value="Corrente">Corrente</option>
              <option value="Poupança">Poupança</option>
              <option value="Investimento">Investimento</option>
            </select>
          </div>
          <div class="text-end">
            <button type="submit" class="btn btn-dark">Salvar Alterações</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="{{ url_for('static', filename='js/Conta.js') }}"></script>
{% endblock %}